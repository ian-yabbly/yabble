##
## UI Template Macros
##

#macro(normalizePath $path)$Utils.normalizePath($path)#end

#macro(appUrl $path)#normalizePath("$__contextPath$path")#end

#macro(staticUrl $path)#normalizePath("$__contextPath/s/$__versionPathPart$path")#end

#macro(formatUserMarkup $s $includeAnchors)$__formatService.formatUserMarkup($s, $includeAnchors)#end
#macro(m $s $includeAnchors)#formatUserMarkup($s, $includeAnchors)#end

#macro(escapeHtml $s)$TextFormat.escapeHtml($s)#end
#macro(e $s)#escapeHtml($s)#end

#macro(imageByUrlAndTransform $url $t)
  #set ($_optTi = $__imageService.optionalOrCreateImageByUrlAndTransform($url, $t))
  #if ($_optTi.isPresent())
    #if ($_optTi.get().isInternal())
      <img
          src="$_optTi.get().secureUrl()"
          width="$_optTi.get().width().get()"
          height="$_optTi.get().height().get()"
          >
    #else
      <img
          #if ($_optTi.get().secureUrl().isDefined())
            src="$_optTi.get().secureUrl()"
          #else
            src="$_optTi.get().url()"
          #end
          >
    #end
  #end
#end

#macro(imagePreset2 $i $t)
  #set ($_optTi = $__imageService.optionalByOriginalIdAndTransform($i.id(), $t, true))
  #if ($_optTi.isPresent())
    <img src="$_optTi.get().secureUrl()" width="$_optTi.get().width().get()"Â height="$_optTi.get().height().get()">
  #end
#end

#macro(imagePreset $i $t)
  #set ($optImage = $__imageService.optionalByOriginalIdAndTransform($i.id(), $t))
  #if ($optImage.isPresent())
    <img src="/i/$i.id()?t=$t" width="$optImage.get().width().get()" height="$optImage.get().height().get()" />
  #end
#end

#macro(transformImageUrl $i $t)
#set ($_optTi = $__imageService.optionalByOriginalIdAndTransform($i.id(), $t, true))
#if ($_optTi.isPresent())$_optTi.get().secureUrl()#end
#end










#* EVERYTHING BELOW HERE IS SUSPECT *#




#macro(profileImage $u $width)
  <span class="user-image">
    #if ($u.Image.isPresent())
      #set ($_optTi = $__imageService.findImageByOriginalExternalIdAndTransform($u.Image.get().ExternalId, "s-$width", false))
      #if ($_optTi.isPresent())
        <img
            src="$_optTi.get().SecureUrl"
            alt="#e($u.displayName())"
            title="#e($u.displayName())"
            width="$width"
            height="$width">
      #else
        <img
            src="/image/profile/$u.Id?s=$width"
            alt="#e($u.displayName())"
            title="#e($u.displayName())"
            width="$width"
            height="$width">
      #end
    #else
      <img
          src="/image/profile/$u.Id?s=$width"
          alt="#e($u.displayName())"
          title="#e($u.displayName())"
          width="$width"
          height="$width">
    #end
  </span>
#end

#macro(profileImageUrl $u $width)
  #if ($u.Image.isPresent())
    #set ($_ti = $__imageService.findImageByOriginalExternalIdAndTransform($u.Image.get().ExternalId, "s-$width", true))
    #if ($ti.isPresent())
      $_ti.get().getUrl($__scheme)
    #else
      $__canonicalBaseUrl/image/profile/$u.Id?s=$width
    #end
  #else
    $__canonicalBaseUrl/image/profile/$u.Id?s=$width
  #end
#end

#macro(userDisplayName $u)
  #if($u.Email.isPresent())
    $u.Email.get()
  #else
    $u.displayName()
  #end
#end
